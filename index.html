<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>查询数据</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; background-color: #f8f9fa; }
    table th, table td { text-align: center; }
    tfoot tr td { font-weight: bold; background-color: #f1f3f5; }
  </style>
</head>
<body>
  <h3 class="mb-4">钢管数据查询</h3>

  <div class="row mb-3">
    <div class="col-md-3">
      <input type="text" id="col1" class="form-control" placeholder="品种">
    </div>
    <div class="col-md-3">
      <input type="text" id="col2" class="form-control" placeholder="口径">
    </div>
    <div class="col-md-3">
      <input type="text" id="col3" class="form-control" placeholder="形式">
    </div>
    <div class="col-md-3">
      <input type="text" id="col4" class="form-control" placeholder="长度">
    </div>
  </div>

  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>品种</th>
        <th>口径</th>
        <th>形式</th>
        <th>长度</th>
        <th>支数</th>
        <th>重量吨</th>
      </tr>
    </thead>
    <tbody id="dataBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="4">合计：</td>
        <td id="totalQty">0</td>
        <td id="totalWeight">0</td>
      </tr>
    </tfoot>
  </table>

  <script>
    let data = [];

    async function fetchData() {
      const response = await fetch("https://raw.githubusercontent.com/quangthanhqldd/gg/main/gg.json");
      data = await response.json();
      renderTable(data);
    }

    function renderTable(filteredData) {
      const body = document.getElementById("dataBody");
      body.innerHTML = "";

      let totalQty = 0;
      let totalWeight = 0;

      filteredData.forEach(row => {
        const tr = document.createElement("tr");
        row.forEach((val, i) => {
          const td = document.createElement("td");
          td.textContent = val;
          tr.appendChild(td);
        });
        body.appendChild(tr);

        // Cộng dồn 2 cột cuối nếu là số
        const qty = parseFloat(row[4]) || 0;
        const weight = parseFloat(row[5]) || 0;
        totalQty += qty;
        totalWeight += weight;
      });

      document.getElementById("totalQty").textContent = totalQty.toLocaleString();
      document.getElementById("totalWeight").textContent = totalWeight.toFixed(3);
    }

    function filterData() {
      const col1 = document.getElementById("col1").value.trim();
      const col2 = document.getElementById("col2").value.trim();
      const col3 = document.getElementById("col3").value.trim();
      const col4 = document.getElementById("col4").value.trim();

      const filtered = data.filter(row =>
        (col1 === "" || row[0].includes(col1)) &&
        (col2 === "" || row[1].toString().includes(col2)) &&
        (col3 === "" || row[2].includes(col3)) &&
        (col4 === "" || row[3].toString().includes(col4))
      );

      renderTable(filtered);
    }

    document.querySelectorAll("input").forEach(input => {
      input.addEventListener("input", filterData);
    });

    fetchData();
  </script>
</body>
</html>
